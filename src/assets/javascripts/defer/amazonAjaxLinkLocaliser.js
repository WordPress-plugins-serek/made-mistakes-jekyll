var amazonAffiliateTags={US:"oddoneout0a-20",CA:"oddoneout0f-20",DE:"oddoneout0c-21",UK:"oddoneout-21",ES:"oddoneout0e-21",IT:"oddoneout01-21",FR:"oddoneout0b-21",CN:"oddoneout-23",JP:"",MX:"",IN:"",BR:""},amazonAffiliateRegions={DE:"DE",AT:"DE",BE:"DE",DK:"DE",FI:"DE",NL:"DE",NO:"DE",PL:"DE",SE:"DE",LI:"DE",LU:"DE",ES:"ES",PT:"ES",AD:"ES",GB:"UK",UK:"UK",IE:"UK",IM:"UK",IT:"IT",VA:"IT",FR:"FR",CA:"CA",US:"US",CN:"CN",BR:"BR",IN:"IN",MX:"MX",DEFAULT:"US"},amazonAffiliateTLDs={DE:"de",UK:"co.uk",ES:"es",IT:"it",FR:"fr",CA:"ca",US:"com",CN:"cn",JP:"co.jp",MX:"com.mx",IN:"in",BR:"com.br"};function localiseLinks(){!function e(){var a=Number(new Date)+5e3;"function"==typeof getCookie&&""!==getCookie("geo_country_code")?localiseAmazonLinks(getCookie("geo_country_code")):Number(new Date)<a&&setTimeout(e,500)}()}function updateQueryStringParameter(e,a,o){var n=new RegExp("([?&])"+a+"=.*?(&|$)","i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,"$1"+a+"="+o+"$2"):e+i+a+"="+o}function localiseAmazonLinks(e){if(e)for(var a=mapCountryCodesToAmazonRegion(e),o=mapRegionToTLD(a),n=document.querySelectorAll("a[href*='://www.amazon.']"),i=RegExp("([\\w-]+/)?(dp|gp/product)/(\\w+/)?(\\w{10})"),t=0,r=n.length;t<r;t++){var f=n[t];f.setAttribute("rel","nofollow");var m=f.getAttribute("data-amazon-asin"),l=mapAmazonRegionToAffiliateTag(a);if(-1!=f.href.indexOf("&field-keywords=")||-1!=f.href.indexOf("?field-keywords=")){var s=f.href.split("://",2)[1].split("/",1)[0];f.href=f.href.replace("://"+s,"://www.amazon."+o),f.href=updateQueryStringParameter(f.href,"tag",l)}else if(m&&(amazonDataEntry=m.toUpperCase().match("\\["+a+"\\](\\s*\\[[a-zA-Z\\.]*\\])*\\s*(\\w*)\\s*($|\\[)"),amazonDataEntry))if(10==amazonDataEntry[2].length)localiseASINTypeLink(amazonDataEntry[2],f,i,l,a);else if(2==amazonDataEntry[2].length){var u=mapCountryCodesToAmazonRegion(amazonDataEntry[2]),d=m.toUpperCase().match("\\["+u+"\\](\\s*\\[[a-zA-Z\\.]*\\])*\\s*(\\w{10})\\s*($|\\[)"),A=mapAmazonRegionToAffiliateTag(u);d&&10==d[2].length&&localiseASINTypeLink(d[2],f,i,A,u)}}}function localiseASINTypeLink(e,a,o,n,i){if(e&&a&&o&&n&&i){var t=a.href.match(o);if(t){var r=a.href.split("://",2)[1].split("/",1)[0];a.href=a.href.replace("://"+r,"://www.amazon."+mapRegionToTLD(i)),a.href=updateQueryStringParameter(a.href,"tag",n),a.href=a.href.split(t[4]).join(e)}}}function mapCountryCodesToAmazonRegion(e){if("amazonAffiliateRegions"in window)return amazonAffiliateRegions[e]||amazonAffiliateRegions.DEFAULT}function mapAmazonRegionToAffiliateTag(e){if("amazonAffiliateTags"in window&&amazonAffiliateTags[e])return amazonAffiliateTags[e];var a="-21";return["US","CA"].indexOf(e)>-1?a="-20":"CN"==e&&(a="-23"),"serek-eu-"+e.toLowerCase()+a}function mapRegionToTLD(e){if("amazonAffiliateTLDs"in window)return amazonAffiliateTLDs[e]}localiseLinks();
